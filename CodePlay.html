<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>CodePlay Editor</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">

    <!-- CodePlay Êú¨‰Ωì„ÅåÂøÖË¶Å„Å®„Åô„Çã„É©„Ç§„Éñ„É©„É™ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['sans-serif'], mono: ['Menlo', 'Monaco', 'Consolas', 'monospace'] },
            colors: { editor: { bg: '#1e1e1e', sidebar: '#252526', active: '#37373d', border: '#333' } }
          },
        },
      }
    </script>
    <style>
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #1e1e1e; }
      ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
      body { margin: 0; overflow: hidden; background-color: #111827; touch-action: manipulation; }
      #root { height: 100vh; height: 100dvh; }
      input, textarea, button { font-size: 14px; }
      textarea::placeholder { color: #555; opacity: 1; }
      .modal-overlay { background-color: rgba(0,0,0,0.7); backdrop-filter: blur(2px); }
    </style>
  </head>
  <body>
    <div id="root" class="w-screen flex flex-col"></div>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useRef, useMemo } = React;

      // --- „Ç¢„Ç§„Ç≥„É≥ÂÆöÁæ© ---
      const Icon = ({ path, size = 18, className = ""}) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} dangerouslySetInnerHTML={{ __html: path }} />);
      const Icons = {
        Menu: (p) => <Icon {...p} path='<line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="18" y2="18"/>' />,
        Plus: (p) => <Icon {...p} path='<path d="M5 12h14"/><path d="M12 5v14"/>' />,
        NewFolder: (p) => <Icon {...p} path='<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" x2="12" y1="11" y2="17"/><line x1="9" x2="15" y1="14" y2="14"/>' />,
        Trash2: (p) => <Icon {...p} path='<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>' />,
        Folder: (p) => <Icon {...p} path='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>' />,
        Edit: (p) => <Icon {...p} path='<path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/>' />,
        File: (p) => <Icon {...p} path='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/>' />,
        X: (p) => <Icon {...p} path='<path d="M18 6 6 18"/><path d="m6 6 12 12"/>' />,
        Code: (p) => <Icon {...p} path='<polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>' />,
        Play: (p) => <Icon {...p} path='<polygon points="5 3 19 12 5 21 5 3"/>' />,
        List: (p) => <Icon {...p} path='<line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>' />,
        RotateCcw: (p) => <Icon {...p} path='<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>' />,
        Archive: (p) => <Icon {...p} path='<rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"/><path d="M10 12h4"/>' />,
        ChevronDown: (p) => <Icon {...p} path='<polyline points="6 9 12 15 18 9"/>' />,
        Github: (p) => <Icon {...p} path='<path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/>' />
      };

      const generateId = () => Date.now().toString(36) + Math.random().toString(36).substring(2);

      const Editor = ({ file, onChange }) => {
        const textareaRef = useRef(null);
        useEffect(() => { if (textareaRef.current) textareaRef.current.scrollTop = 0; }, [file?.id]);
        if (!file) return <div className="flex-1 flex flex-col items-center justify-center text-gray-500 bg-editor-bg h-full"><Icons.Code size={48} className="mb-4 opacity-20" /><p>„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p></div>;
        return (
          <div className="flex flex-col h-full bg-editor-bg">
            <div className="flex items-center justify-between px-4 py-2 bg-editor-sidebar border-b border-editor-border shrink-0"><span className="text-sm font-medium text-gray-200">{file.name}</span></div>
            <textarea ref={textareaRef} value={file.content} onChange={(e) => onChange(e.target.value)} className="flex-1 w-full bg-editor-bg text-gray-300 font-mono text-sm p-4 resize-none focus:outline-none leading-6" spellCheck={false} autoCapitalize="off" placeholder="// „Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ..." />
          </div>
        );
      };

      const buildFileTree = (files) => {
        const root = { name: "root", isFolder: true, children: {}, path: "" };
        files.forEach(file => {
          const parts = file.name.split('/');
          let current = root;
          parts.forEach((part, index) => {
            const currentPath = parts.slice(0, index + 1).join('/');
            if (index === parts.length - 1) current.children[part] = { ...file, isFolder: false, path: file.name };
            else { if (!current.children[part]) current.children[part] = { name: part, isFolder: true, children: {}, path: currentPath }; current = current.children[part]; }
          });
        });
        return root;
      };

      const FileTreeNode = ({ node, activeFileId, onSelect, onDelete, onRenameFile, onRenameFolder, onDeleteFolder, depth = 0 }) => {
        const [isOpen, setIsOpen] = useState(true);
        if (!node.isFolder) {
          return (
             <div onClick={() => onSelect(node.id)} className={`group flex justify-between items-center py-1.5 pr-2 cursor-pointer text-sm hover:bg-gray-800 ${activeFileId === node.id ? 'bg-editor-active text-white border-l-2 border-l-blue-500' : 'text-gray-400 border-l-2 border-transparent'}`} style={{ paddingLeft: `${depth * 12 + 12}px` }}>
                <div className="flex items-center gap-1.5 min-w-0 overflow-hidden"><Icons.File size={14} className="shrink-0 opacity-70" /><span className="truncate">{node.name.split('/').pop()}</span></div>
                <div className="flex opacity-0 group-hover:opacity-100 transition-opacity gap-1"><button onClick={(e)=>{e.stopPropagation(); onRenameFile(node);}} className="text-gray-500 hover:text-white"><Icons.Edit size={13}/></button><button onClick={(e)=>{e.stopPropagation(); if(confirm(`ÂâäÈô§: ${node.name}?`)) onDelete(node.id);}} className="text-gray-500 hover:text-red-400"><Icons.Trash2 size={13}/></button></div>
             </div>
          );
        }
        const children = Object.values(node.children).sort((a, b) => (a.isFolder === b.isFolder ? a.name.localeCompare(b.name) : a.isFolder ? -1 : 1));
        if (node.name === "root") return <div className="flex flex-col">{children.map((child) => <FileTreeNode key={child.path} node={child} activeFileId={activeFileId} onSelect={onSelect} onDelete={onDelete} onRenameFile={onRenameFile} onRenameFolder={onRenameFolder} onDeleteFolder={onDeleteFolder} depth={0} />)}</div>;
        return (
          <div className="flex flex-col select-none">
            <div onClick={() => setIsOpen(!isOpen)} className={`group flex justify-between items-center py-1.5 pr-2 cursor-pointer text-sm text-gray-300 hover:bg-gray-800 hover:text-white`} style={{ paddingLeft: `${depth * 12 + 6}px` }}>
              <div className="flex items-center gap-1 min-w-0 overflow-hidden"><span className="p-0.5 text-gray-500">{isOpen ? <Icons.ChevronDown size={14}/> : <Icons.ChevronRight size={14}/>}</span><Icons.Folder size={14} className="shrink-0 text-blue-400" /><span className="truncate font-medium">{node.name}</span></div>
              <div className="flex opacity-0 group-hover:opacity-100 transition-opacity gap-1"><button onClick={(e)=>{e.stopPropagation(); onRenameFolder(node.path, node.name);}} className="text-gray-500 hover:text-white"><Icons.Edit size={13}/></button><button onClick={(e)=>{e.stopPropagation(); if(confirm(`„Éï„Ç©„É´„ÉÄÂâäÈô§: ${node.name}?`)) onDeleteFolder(node.path);}} className="text-gray-500 hover:text-red-400"><Icons.Trash2 size={13}/></button></div>
            </div>
            {isOpen && <div className="flex flex-col">{children.map((child) => <FileTreeNode key={child.path} node={child} activeFileId={activeFileId} onSelect={onSelect} onDelete={onDelete} onRenameFile={onRenameFile} onRenameFolder={onRenameFolder} onDeleteFolder={onDeleteFolder} depth={depth + 1} />)}</div>}
          </div>
        );
      };

      const GitHubModal = ({ isOpen, onClose, files }) => {
         const [token, setToken] = useState(localStorage.getItem('cp_gh_token') || '');
         const [repo, setRepo] = useState(localStorage.getItem('cp_gh_repo') || '');
         const [branch, setBranch] = useState(localStorage.getItem('cp_gh_branch') || 'main');
         const [status, setStatus] = useState('');
         const [isUploading, setIsUploading] = useState(false);
         const handlePush = async () => {
             if(!token || !repo) return alert('Token„Å®„É™„Éù„Ç∏„Éà„É™Âêç„ÅØÂøÖÈ†à„Åß„Åô');
             localStorage.setItem('cp_gh_token', token); localStorage.setItem('cp_gh_repo', repo); localStorage.setItem('cp_gh_branch', branch);
             setIsUploading(true); setStatus('Êé•Á∂ö‰∏≠...');
             try {
                const headers = { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' };
                const repoUrl = `https://api.github.com/repos/${repo}`;
                let res = await fetch(repoUrl, { headers }); if (!res.ok) throw new Error(`„É™„Éù„Ç∏„Éà„É™„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${res.status}`);
                const validFiles = files.filter(f => !f.name.endsWith('.keep'));
                for (const file of validFiles) {
                    setStatus(`Uploading ${file.name}...`);
                    const content = btoa(unescape(encodeURIComponent(file.content)));
                    const fileUrl = `${repoUrl}/contents/${file.name}`;
                    let sha = null;
                    try { const check = await fetch(fileUrl + `?ref=${branch}`, { headers }); if(check.ok) sha = (await check.json()).sha; } catch(e){}
                    const body = { message: `Update ${file.name}`, content, branch, ...(sha ? {sha} : {}) };
                    const put = await fetch(fileUrl, { method: 'PUT', headers: {...headers, 'Content-Type': 'application/json'}, body: JSON.stringify(body) });
                    if(!put.ok) throw new Error(`Failed: ${file.name}`);
                }
                setStatus('ÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ');
             } catch(e) { setStatus('Error: ' + e.message); } finally { setIsUploading(false); }
         };
         if(!isOpen) return null;
         return (
             <div className="fixed inset-0 z-[100] modal-overlay flex items-center justify-center p-4">
                 <div className="bg-gray-900 border border-gray-700 rounded-lg w-full max-w-md p-6 shadow-2xl">
                     <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><Icons.Github size={24}/> GitHub„Å∏„Éó„ÉÉ„Ç∑„É•</h2>
                     <div className="space-y-3">
                         <div><label className="text-xs text-gray-400">GitHub Token</label><input value={token} onChange={e=>setToken(e.target.value)} type="password" className="w-full bg-gray-800 text-white p-2 rounded border border-gray-700 mt-1"/></div>
                         <div><label className="text-xs text-gray-400">Repo (user/repo)</label><input value={repo} onChange={e=>setRepo(e.target.value)} className="w-full bg-gray-800 text-white p-2 rounded border border-gray-700 mt-1"/></div>
                         <div className="text-xs font-mono text-green-400 min-h-[20px]">{status}</div>
                         <div className="flex justify-end gap-2 mt-2"><button onClick={onClose} className="px-4 py-2 text-sm text-gray-400">Èñâ„Åò„Çã</button><button onClick={handlePush} disabled={isUploading} className="px-4 py-2 text-sm bg-green-600 text-white rounded font-bold">{isUploading?'...':'Push'}</button></div>
                     </div>
                 </div>
             </div>
         );
      };

      const Preview = ({ files }) => {
        const [srcDoc, setSrcDoc] = useState('');
        useEffect(() => {
          const process = async () => {
            const fileMap = {}; files.forEach(f => fileMap[f.name] = f.content);
            let rawHtml = fileMap['index.html'] || `<!DOCTYPE html><html><body><div id="root"></div></body></html>`;
            const css = files.filter(f => f.name.endsWith('.css')).map(f => f.content).join('\n');
            const styleTag = `<style>${css} body { background-color: white; }</style>`;
            if (rawHtml.includes('</head>')) rawHtml = rawHtml.replace('</head>', `${styleTag}</head>`); else rawHtml += styleTag;

            const localImports = {};
            const scriptFiles = files.filter(f => /\.(ts|tsx|js|jsx)$/.test(f.name) && !f.name.includes('vite.config'));
            for (const file of scriptFiles) {
              try {
                const result = window.Babel.transform(file.content, { presets: [['env', { modules: false, targets: { esmodules: true } }], 'react', 'typescript'], filename: file.name });
                const blob = new Blob([result.code], { type: 'application/javascript' });
                const url = URL.createObjectURL(blob);
                const paths = [ "./" + file.name, "/" + file.name, "./" + file.name.replace(/\.(tsx|ts|jsx|js)$/, ''), "/" + file.name.replace(/\.(tsx|ts|jsx|js)$/, '') ];
                paths.forEach(p => localImports[p] = url);
              } catch (e) { console.error("Compile Error:", file.name, e); }
            }

            let finalImportMap = { imports: localImports };
            const importMapRegex = /<script\s+type=["']importmap["']>([\s\S]*?)<\/script>/i;
            const match = rawHtml.match(importMapRegex);
            if (match) {
                try {
                    const userMap = JSON.parse(match[1]);
                    finalImportMap.imports = { ...localImports, ...userMap.imports };
                    rawHtml = rawHtml.replace(importMapRegex, '');
                } catch(e) {}
            }
            
            rawHtml = rawHtml.replace(/<script\s+type=["']module["']\s+src=["']([^"']+)["']\s*><\/script>/gi, (match, srcPath) => {
                let cleanPath = srcPath.startsWith('/') ? "." + srcPath : (srcPath.startsWith('.') ? srcPath : "./" + srcPath);
                return `<script type="module">import "${cleanPath}";<\/script>`;
            });

            const headExtras = `<script type="importmap">${JSON.stringify(finalImportMap, null, 2)}<\/script>`;
            if (rawHtml.includes('<head>')) rawHtml = rawHtml.replace('<head>', `<head>${headExtras}`); else rawHtml = headExtras + rawHtml;
            setSrcDoc(rawHtml);
          };
          process();
        }, [files]);

        return <iframe srcDoc={srcDoc} className="flex-1 w-full h-full bg-white border-none" sandbox="allow-scripts allow-modals allow-same-origin allow-forms" title="Preview" />;
      };

      const FileExplorer = ({ files, activeFileId, onSelect, onAdd, onDelete, onUpload, onRenameFile, onRenameFolder, onDeleteFolder, onGitHub }) => {
        const [name, setName] = useState('');
        const [isAdding, setIsAdding] = useState(false);
        const fileInputRef = useRef(null);
        const fileTree = useMemo(() => buildFileTree(files), [files]);
        const handleSubmit = (e) => { e.preventDefault(); if(!name)return; onAdd(name, 'text', ''); setName(''); setIsAdding(false); };
        const handleCreateFolder = () => { const n = prompt("„Éï„Ç©„É´„ÉÄÂêç:"); if(n) onAdd(`${n}/.keep`, 'text', ''); };
        const handleDownloadZip = async () => {
          if (!window.JSZip) { alert('JSZip not loaded.'); return; }
          const zip = new JSZip(); files.forEach(f => { if(!f.name.endsWith('.keep')) zip.file(f.name, f.content); });
          const content = await zip.generateAsync({type: "blob"});
          const link = document.createElement('a'); link.href = URL.createObjectURL(content); link.download = `codeplay_project.zip`; document.body.appendChild(link); link.click(); document.body.removeChild(link);
        };
        const handleUpload = (e) => { Array.from(e.target.files).forEach(file => { const r = new FileReader(); r.onload = (ev) => onUpload(file.name, ev.target.result, 'text'); r.readAsText(file); }); e.target.value = ''; }
        
        return (
          <div className="flex flex-col h-full bg-editor-sidebar border-r border-editor-border">
             <div className="p-3 border-b border-editor-border flex justify-between items-center shrink-0">
               <span className="text-xs font-bold text-gray-400">Explorer</span>
               <div className="flex gap-1">
                 <button onClick={onGitHub} className="text-gray-400 hover:text-white p-1" title="GitHub Push"><Icons.Github size={16}/></button>
                 <button onClick={handleDownloadZip} className="text-gray-400 hover:text-white p-1" title="ZIP Download"><Icons.Archive size={16}/></button>
                 <button onClick={()=>fileInputRef.current.click()} className="text-gray-400 hover:text-white p-1" title="Import File"><Icons.Upload size={16}/></button>
                 <button onClick={handleCreateFolder} className="text-gray-400 hover:text-white p-1" title="New Folder"><Icons.NewFolder size={16}/></button>
                 <button onClick={()=>setIsAdding(!isAdding)} className="text-gray-400 hover:text-white p-1" title="New File"><Icons.Plus size={16}/></button>
               </div>
               <input type="file" multiple ref={fileInputRef} onChange={handleUpload} className="hidden" />
             </div>
             {isAdding && <form onSubmit={handleSubmit} className="p-2 bg-gray-800 shrink-0 border-b border-editor-border"><input value={name} onChange={e=>setName(e.target.value)} className="w-full bg-gray-900 text-white text-sm p-2 rounded outline-none border border-blue-500" placeholder="‰æã: src/App.tsx" autoFocus onBlur={()=>{if(!name)setIsAdding(false)}}/></form>}
             <div className="flex-1 overflow-y-auto group">
               {files.length === 0 ? <div className="p-4 text-xs text-center text-gray-600">„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div> : <FileTreeNode node={fileTree} activeFileId={activeFileId} onSelect={onSelect} onDelete={onDelete} onRenameFile={onRenameFile} onRenameFolder={onRenameFolder} onDeleteFolder={onDeleteFolder} />}
             </div>
          </div>
        );
      };

      const App = () => {
        const [files, setFiles] = useState(() => { try { return JSON.parse(localStorage.getItem('cp_files') || '[]'); } catch { return []; } });
        const [activeId, setActiveId] = useState(null);
        const [sidebarOpen, setSidebarOpen] = useState(false);
        const [mobileTab, setMobileTab] = useState('files');
        const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
        const [showGithub, setShowGithub] = useState(false);
        useEffect(() => localStorage.setItem('cp_files', JSON.stringify(files)), [files]);
        useEffect(() => { const h = () => setIsMobile(window.innerWidth < 768); window.addEventListener('resize', h); return () => window.removeEventListener('resize', h); }, []);

        const handleRenameFile = (node) => { const n = prompt("Êñ∞„Åó„ÅÑ„Éï„Ç°„Ç§„É´Âêç:", node.name); if (n && n !== node.name) setFiles(prev => prev.map(f => f.id === node.id ? { ...f, name: n } : f)); };
        const handleRenameFolder = (oldP, oldN) => { const n = prompt("Êñ∞„Åó„ÅÑ„Éï„Ç©„É´„ÉÄÂêç:", oldN); if (n && n !== oldN) { const pre = oldP + "/", parent = oldP.substring(0, oldP.lastIndexOf('/')), newP = parent ? `${parent}/${n}` : n; setFiles(prev => prev.map(f => f.name.startsWith(pre) ? { ...f, name: f.name.replace(oldP, newP) } : f)); }};
        const handleDeleteFolder = (path) => setFiles(prev => prev.filter(f => !f.name.startsWith(path + "/")));

        const activeFile = files.find(f => f.id === activeId);

        return (
          <div className="flex flex-col h-full text-white font-sans bg-gray-900">
            <header className="bg-editor-sidebar border-b border-editor-border p-1 flex items-center justify-between shrink-0 h-16 z-20 shadow-md">
               <div className="flex items-center gap-2 pl-1">
                 <div className="flex flex-col justify-center pl-2"><span className="font-bold text-base tracking-tight leading-tight">CodePlay</span><span className="text-[10px] text-gray-500 leading-tight">Environment</span></div>
               </div>
               <div className="flex items-center gap-1 pr-1"><button onClick={()=>{if(confirm('ÁèæÂú®„ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')){setFiles([]); setActiveId(null);}}} className="flex flex-col items-center justify-center p-2 text-gray-400 hover:text-white rounded hover:bg-gray-700 w-14"><Icons.RotateCcw size={18}/><span className="text-[10px] mt-0.5">Reset</span></button></div>
            </header>
            <main className="flex-1 flex overflow-hidden relative">
               <div className={`${(isMobile && mobileTab !== 'files') ? 'hidden' : 'flex'} w-full md:w-56 md:flex-none flex-col h-full z-10 border-r border-editor-border bg-editor-sidebar`}>
                  <FileExplorer files={files} activeFileId={activeId} onSelect={(id)=>{setActiveId(id); if(isMobile) setMobileTab('editor');}} onAdd={(n,l,c)=>setFiles([...files, {id:generateId(), name:n, language:l, content:c||''} ])} onDelete={(id)=>{setFiles(f=>f.filter(x=>x.id!==id)); if(activeId===id) setActiveId(null);}} onUpload={(n,c,l)=>setFiles(prev=>[...prev, {id:generateId(), name:n, language:l, content:c}])} onRenameFile={handleRenameFile} onRenameFolder={handleRenameFolder} onDeleteFolder={handleDeleteFolder} onGitHub={()=>setShowGithub(true)} />
               </div>
               <div className={`${(isMobile && mobileTab !== 'editor') ? 'hidden' : 'flex'} flex-1 flex-col min-w-0 md:border-r border-editor-border md:max-w-[50%]`}>
                 <Editor file={activeFile} onChange={(val)=>setFiles(files.map(f=>f.id===activeId?{...f, content:val}:f))} />
               </div>
               <div className={`${(isMobile && mobileTab !== 'preview') ? 'hidden' : 'flex'} flex-1 flex-col bg-white h-full`}><Preview files={files} /></div>
            </main>
            <div className="md:hidden h-16 bg-editor-sidebar border-t border-editor-border flex items-center justify-around shrink-0 pb-safe z-30">
              <button onClick={()=>setMobileTab('files')} className={`flex flex-col items-center justify-center gap-0.5 w-full h-full ${mobileTab==='files'?'text-blue-400 bg-gray-800':'text-gray-500'}`}><Icons.List size={20}/><span className="text-[10px]">Files</span></button>
              <button onClick={()=>setMobileTab('editor')} className={`flex flex-col items-center justify-center gap-0.5 w-full h-full ${mobileTab==='editor'?'text-blue-400 bg-gray-800':'text-gray-500'}`}><Icons.Code size={20}/><span className="text-[10px]">Code</span></button>
              <button onClick={()=>setMobileTab('preview')} className={`flex flex-col items-center justify-center gap-0.5 w-full h-full ${mobileTab==='preview'?'text-blue-400 bg-gray-800':'text-gray-500'}`}><Icons.Play size={20}/><span className="text-[10px]">Run</span></button>
            </div>
            <GitHubModal isOpen={showGithub} onClose={()=>setShowGithub(false)} files={files} />
          </div>
        );
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
