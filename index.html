<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>CodePlay AI (Master Edition)</title>
    
    <!-- ローカルにあるライブラリを読み込み (エディタ用) -->
    <script src="tailwind.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['sans-serif'], mono: ['monospace'] },
            colors: { editor: { bg: '#1e1e1e', sidebar: '#252526', active: '#37373d', border: '#333' } }
          },
        },
      }
    </script>
    <script src="react.js"></script>
    <script src="react-dom.js"></script>
    <script src="babel.js"></script>
    
    <style>
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #1e1e1e; }
      ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
      body { margin: 0; overflow: hidden; background-color: #111827; touch-action: manipulation; }
      input, textarea, button { font-size: 14px; }
    </style>
  </head>
  <body>
    <div id="root" class="h-screen w-screen flex flex-col"></div>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useRef } = React;

      // --- アイコン (SVG) ---
      const Icon = ({ path, size = 18, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} dangerouslySetInnerHTML={{ __html: path }} />
      );
      const Icons = {
        Menu: (p) => <Icon {...p} path='<line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="18" y2="18"/>' />,
        Plus: (p) => <Icon {...p} path='<path d="M5 12h14"/><path d="M12 5v14"/>' />,
        Trash2: (p) => <Icon {...p} path='<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>' />,
        Folder: (p) => <Icon {...p} path='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>' />,
        X: (p) => <Icon {...p} path='<path d="M18 6 6 18"/><path d="m6 6 12 12"/>' />,
        Settings: (p) => <Icon {...p} path='<path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>' />,
        Check: (p) => <Icon {...p} path='<polyline points="20 6 9 17 4 12"/>' />,
        Copy: (p) => <Icon {...p} path='<rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>' />,
        Wand2: (p) => <Icon {...p} path='<path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/>' />,
        RefreshCw: (p) => <Icon {...p} path='<path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>' />,
        Code: (p) => <Icon {...p} path='<polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>' />,
        Play: (p) => <Icon {...p} path='<polygon points="5 3 19 12 5 21 5 3"/>' />,
        List: (p) => <Icon {...p} path='<line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>' />
      };

      const generateId = () => Date.now().toString(36) + Math.random().toString(36).substring(2);

      // --- エディタ画面 ---
      const Editor = ({ file, onChange }) => {
        const [copied, setCopied] = useState(false);
        const textareaRef = useRef(null);
        useEffect(() => { if (textareaRef.current) textareaRef.current.scrollTop = 0; }, [file?.id]);

        const handleKeyDown = (e) => {
          if (e.key === 'Tab') {
            e.preventDefault();
            const start = e.target.selectionStart;
            const end = e.target.selectionEnd;
            const val = file?.content || '';
            onChange(val.substring(0, start) + '  ' + val.substring(end));
            requestAnimationFrame(() => { e.target.selectionStart = e.target.selectionEnd = start + 2; });
          }
        };

        if (!file) return <div className="flex-1 flex flex-col items-center justify-center text-gray-500 bg-editor-bg h-full"><Icons.Code size={48} className="mb-4 opacity-20" /><p>ファイルを選択してください</p></div>;

        return (
          <div className="flex flex-col h-full bg-editor-bg relative group">
            <div className="flex items-center justify-between px-4 py-2 bg-editor-sidebar border-b border-editor-border shrink-0">
              <span className="text-sm font-medium text-gray-200">{file.name}</span>
              <button onClick={() => { navigator.clipboard.writeText(file.content); setCopied(true); setTimeout(()=>setCopied(false),2000); }} className="text-gray-500 hover:text-white p-1 rounded hover:bg-gray-700">
                {copied ? <Icons.Check size={14} className="text-green-500" /> : <Icons.Copy size={14} />}
              </button>
            </div>
            <textarea
              ref={textareaRef}
              value={file.content}
              onChange={(e) => onChange(e.target.value)}
              onKeyDown={handleKeyDown}
              className="flex-1 w-full bg-editor-bg text-gray-300 font-mono text-sm p-4 resize-none focus:outline-none leading-6"
              spellCheck={false}
              autoCapitalize="off"
            />
          </div>
        );
      };

      // --- プレビュー画面 (重要: 複数ファイル対応 & フォルダ内ライブラリ読み込み) ---
      const Preview = ({ files }) => {
        const [srcDoc, setSrcDoc] = useState('');
        
        useEffect(() => {
          // エントリーポイントを探す
          const htmlFile = files.find(f => f.name === 'index.html');
          if (!htmlFile) { setSrcDoc('<html><body style="color:#888;background:#111;padding:20px;font-family:sans-serif;">index.html が見つかりません。</body></html>'); return; }

          // 全てのCSSファイルを結合
          const allCss = files.filter(f => f.name.endsWith('.css')).map(f => `/* ${f.name} */\n${f.content}`).join('\n');
          
          // 全てのJSファイルを結合 (モジュールシステムなしの簡易連結)
          const allJs = files.filter(f => f.name.endsWith('.js')).map(f => `// ${f.name}\ntry{${f.content.replace(/import .*?;/g,'')}}catch(e){console.error(e)}`).join('\n');
          
          // TS/TSXのコンパイル
          let tsCompiled = '';
          if (window.Babel) {
            files.filter(f => f.name.endsWith('.ts') || f.name.endsWith('.tsx')).forEach(f => {
              try {
                tsCompiled += `// ${f.name}\n` + window.Babel.transform(f.content, { presets: ['react', 'typescript'], filename: f.name }).code + '\n';
              } catch(e) { console.error('Compile Error in ' + f.name, e); }
            });
          }

          let doc = htmlFile.content;

          // CSS注入 (<head>の末尾へ)
          const styleTag = `<style>${allCss}</style>`;
          if(doc.includes('</head>')) doc = doc.replace('</head>', `${styleTag}</head>`);
          else doc = styleTag + doc;

          // ライブラリ注入 (index.htmlと同じフォルダにあると仮定)
          // 注意: iframeのsrcdoc内で相対パス(react.js)を使うため、
          // index.htmlを開いているブラウザがローカルファイルアクセスを許可している必要があります。
          const libs = `
            <script src="tailwind.js"><\/script>
            <script src="react.js"><\/script>
            <script src="react-dom.js"><\/script>
          `;
          if(doc.includes('<head>')) doc = doc.replace('<head>', `<head>${libs}`);
          else doc = libs + doc;

          // JS注入 (<body>の末尾へ)
          const scriptTag = `<script>${allJs}\n${tsCompiled}<\/script>`;
          if(doc.includes('</body>')) doc = doc.replace('</body>', `${scriptTag}</body>`);
          else doc += scriptTag;

          setSrcDoc(doc);
        }, [files]);

        return <iframe srcDoc={srcDoc} className="flex-1 w-full h-full bg-white border-none" sandbox="allow-scripts allow-modals allow-same-origin" title="Preview" />;
      };

      // --- ファイル管理 ---
      const FileExplorer = ({ files, activeFileId, onSelect, onAdd, onDelete }) => {
        const [name, setName] = useState('');
        const [isAdding, setIsAdding] = useState(false);
        
        const handleSubmit = (e) => {
          e.preventDefault();
          if(!name) return;
          // 拡張子から言語を推測 (特に指定がなければJS)
          let lang = 'javascript';
          if(name.endsWith('.html')) lang = 'html';
          if(name.endsWith('.css')) lang = 'css';
          if(name.endsWith('.json')) lang = 'json';
          if(name.endsWith('.ts') || name.endsWith('.tsx')) lang = 'typescript';
          
          onAdd(name, lang);
          setName(''); setIsAdding(false);
        };

        return (
          <div className="flex flex-col h-full bg-editor-sidebar border-r border-editor-border">
             <div className="p-3 border-b border-editor-border flex justify-between items-center shrink-0">
               <span className="text-xs font-bold text-gray-400">ファイル一覧</span>
               <button onClick={()=>setIsAdding(!isAdding)} className="text-gray-400 hover:text-white p-1" title="新規ファイル"><Icons.Plus size={18}/></button>
             </div>
             {isAdding && (
               <form onSubmit={handleSubmit} className="p-2 bg-gray-800 shrink-0 border-b border-editor-border">
                 <input value={name} onChange={e=>setName(e.target.value)} className="w-full bg-gray-900 text-white text-sm p-2 rounded outline-none border border-blue-500" placeholder="例: style.css" autoFocus onBlur={()=>{if(!name)setIsAdding(false)}}/>
               </form>
             )}
             <div className="flex-1 overflow-y-auto">
               {files.map(f => (
                 <div key={f.id} onClick={()=>onSelect(f.id)} className={`flex justify-between items-center px-4 py-2 cursor-pointer text-sm border-b border-gray-800 hover:bg-gray-800 ${activeFileId===f.id ? 'bg-editor-active text-white border-l-4 border-l-blue-500' : 'text-gray-400'}`}>
                   <span className="truncate">{f.name}</span>
                   <button onClick={(e)=>{e.stopPropagation(); if(confirm(`${f.name} を削除しますか？`)) onDelete(f.id)}} className="text-gray-600 hover:text-red-400 p-1"><Icons.Trash2 size={14}/></button>
                 </div>
               ))}
             </div>
          </div>
        );
      };

      // --- 設定モーダル (APIキー用) ---
      const SettingsModal = ({ isOpen, onClose }) => {
        const [key, setKey] = useState('');
        
        useEffect(() => {
          if(isOpen) setKey(localStorage.getItem('gemini_key') || '');
        }, [isOpen]);

        const save = () => {
          localStorage.setItem('gemini_key', key);
          alert('APIキーを保存しました。');
          onClose();
        };

        if(!isOpen) return null;
        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
            <div className="bg-gray-900 border border-gray-700 p-6 rounded-lg w-96 shadow-xl">
              <h2 className="text-white text-lg font-bold mb-4 flex items-center gap-2"><Icons.Settings size={20}/> 設定</h2>
              <div className="mb-4">
                <label className="block text-gray-400 text-xs mb-1">Gemini API Key</label>
                <input value={key} onChange={e=>setKey(e.target.value)} type="password" placeholder="AIを使う場合はここに入力" className="w-full bg-gray-950 text-white border border-gray-700 rounded p-2 text-sm focus:border-blue-500 outline-none"/>
                <p className="text-gray-600 text-[10px] mt-1">※キーはブラウザにのみ保存されます</p>
              </div>
              <div className="flex justify-end gap-2">
                <button onClick={onClose} className="text-gray-400 hover:text-white px-3 py-1 text-sm">閉じる</button>
                <button onClick={save} className="bg-blue-600 text-white px-4 py-1.5 rounded text-sm hover:bg-blue-500">保存</button>
              </div>
            </div>
          </div>
        );
      };

      // --- メインアプリ ---
      const App = () => {
        // 初期ファイル構成
        const INITIAL_FILES = [
          {id:'1', name:'index.html', language:'html', content:'<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n</head>\n<body>\n  <div id="root"></div>\n</body>\n</html>'},
          {id:'2', name:'style.css', language:'css', content:'body { background: #f0f9ff; color: #333; }'},
          {id:'3', name:'main.tsx', language:'typescript', content:'// Reactコンポーネント\nconst App = () => {\n  return (\n    <div className="p-10 text-center">\n      <h1 className="text-3xl font-bold text-blue-600">Hello CodePlay!</h1>\n      <p className="mt-4">HTML, CSS, JSを個別に管理できます。</p>\n    </div>\n  );\n};\n\nconst root = ReactDOM.createRoot(document.getElementById("root"));\nroot.render(<App />);'}
        ];

        const [files, setFiles] = useState(INITIAL_FILES);
        const [activeId, setActiveId] = useState('3');
        const [prompt, setPrompt] = useState('');
        const [loading, setLoading] = useState(false);
        
        // UI状態
        const [sidebarOpen, setSidebarOpen] = useState(false); // プロジェクトメニュー
        const [settingsOpen, setSettingsOpen] = useState(false); // API設定
        const [mobileTab, setMobileTab] = useState('editor'); // スマホ用タブ
        const [isMobile, setIsMobile] = useState(window.innerWidth < 768);

        // プロジェクト保存機能
        const [projects, setProjects] = useState(() => { try { return JSON.parse(localStorage.getItem('cp_projects')||'[]'); } catch{ return []; } });
        useEffect(() => localStorage.setItem('cp_projects', JSON.stringify(projects)), [projects]);
        useEffect(() => {
            const handleResize = () => setIsMobile(window.innerWidth < 768);
            window.addEventListener('resize', handleResize);
            return () => window.removeEventListener('resize', handleResize);
        }, []);

        // AI生成ロジック
        const generateCode = async () => {
          if(!navigator.onLine) { alert('AI生成にはインターネットが必要です。'); return; }
          const key = localStorage.getItem('gemini_key');
          if(!key) { setSettingsOpen(true); return; } // キーがないなら設定を開く
          if(!prompt) return;

          setLoading(true);
          try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`, {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({
                contents: [{ parts: [{ text: `Generate web app files (index.html, css, js/ts) for: ${prompt}. Return JSON object {files: [{name, content, language}]}. No markdown.` }] }]
              })
            });
            const data = await res.json();
            if(data.error) throw new Error(data.error.message);
            
            const txt = data.candidates[0].content.parts[0].text;
            const jsonStr = txt.replace(/```json|```/g, ''); 
            const parsed = JSON.parse(jsonStr);
            if(parsed.files) {
              const newFiles = parsed.files.map(f => ({id: generateId(), name: f.name, language: f.language || 'javascript', content: f.content}));
              setFiles(newFiles);
              setActiveId(newFiles.find(f=>f.name.endsWith('ts')||f.name.endsWith('js'))?.id || newFiles[0].id);
              if(isMobile) setMobileTab('preview');
            }
          } catch(e) { alert('エラー: ' + e.message); }
          setLoading(false);
        };

        const activeFile = files.find(f => f.id === activeId);

        return (
          <div className="flex flex-col h-full text-white font-sans bg-gray-900">
            {/* モーダル類 */}
            <SettingsModal isOpen={settingsOpen} onClose={()=>setSettingsOpen(false)} />
            
            {/* ヘッダー */}
            <header className="bg-editor-sidebar border-b border-editor-border p-2 flex items-center justify-between shrink-0 h-14 z-20">
               <div className="flex items-center gap-3">
                 <button onClick={()=>setSidebarOpen(true)} className="p-2 hover:bg-gray-700 rounded text-gray-400"><Icons.Menu size={20}/></button>
                 <span className="font-bold hidden sm:block text-lg tracking-tight">CodePlay</span>
               </div>
               
               <div className="flex-1 max-w-xl mx-2 sm:mx-4 flex gap-2">
                 <div className="relative flex-1">
                    <input value={prompt} onChange={e=>setPrompt(e.target.value)} onKeyDown={e=>e.key==='Enter'&&generateCode()} placeholder={navigator.onLine ? "AIに指示 (例: 電卓を作って)" : "オフラインモード"} disabled={!navigator.onLine} className="w-full bg-gray-950 border border-editor-border rounded px-3 text-sm focus:border-blue-500 outline-none disabled:opacity-50 h-9 pl-3 pr-8"/>
                 </div>
                 <button onClick={generateCode} disabled={loading||!navigator.onLine} className="bg-blue-600 px-3 rounded text-sm font-bold disabled:opacity-50 h-9 w-12 flex items-center justify-center transition-colors hover:bg-blue-500">
                    {loading ? <Icons.RefreshCw className="animate-spin"/> : <Icons.Wand2/>}
                 </button>
               </div>
               
               <div className="flex gap-1">
                   <button onClick={()=>setSettingsOpen(true)} className="p-2 text-gray-400 hover:text-white rounded hover:bg-gray-700" title="API設定"><Icons.Settings size={20}/></button>
               </div>
            </header>

            {/* メインコンテンツ */}
            <main className="flex-1 flex overflow-hidden relative">
               
               {/* 1. ファイル一覧エリア (PC:表示 / スマホ:タブ選択時のみ) */}
               <div className={`${(isMobile && mobileTab !== 'files') ? 'hidden' : 'flex'} w-full md:w-56 md:flex-none flex-col h-full z-10 border-r border-editor-border bg-editor-sidebar`}>
                  <FileExplorer files={files} activeFileId={activeId} onSelect={(id)=>{setActiveId(id); if(isMobile) setMobileTab('editor');}} onAdd={(n,l)=>setFiles([...files, {id:generateId(), name:n, language:l, content:''} ])} onDelete={(id)=>{setFiles(f=>f.filter(x=>x.id!==id)); if(activeId===id) setActiveId(null);}} />
               </div>

               {/* 2. エディタエリア */}
               <div className={`${(isMobile && mobileTab !== 'editor') ? 'hidden' : 'flex'} flex-1 flex-col min-w-0 md:border-r border-editor-border md:max-w-[50%]`}>
                 <Editor file={activeFile} onChange={(val)=>setFiles(files.map(f=>f.id===activeId?{...f, content:val}:f))} />
               </div>

               {/* 3. プレビューエリア */}
               <div className={`${(isMobile && mobileTab !== 'preview') ? 'hidden' : 'flex'} flex-1 flex-col bg-white h-full`}>
                  <Preview files={files} />
               </div>

            </main>

            {/* スマホ用ボトムタブ */}
            <div className="md:hidden h-14 bg-editor-sidebar border-t border-editor-border flex items-center justify-around shrink-0 pb-safe z-30">
              <button onClick={()=>setMobileTab('files')} className={`flex flex-col items-center gap-1 p-2 w-full ${mobileTab==='files'?'text-blue-400 bg-gray-800':'text-gray-500'}`}>
                <Icons.List size={18}/> <span className="text-[10px]">ファイル</span>
              </button>
              <button onClick={()=>setMobileTab('editor')} className={`flex flex-col items-center gap-1 p-2 w-full ${mobileTab==='editor'?'text-blue-400 bg-gray-800':'text-gray-500'}`}>
                <Icons.Code size={18}/> <span className="text-[10px]">コード</span>
              </button>
              <button onClick={()=>setMobileTab('preview')} className={`flex flex-col items-center gap-1 p-2 w-full ${mobileTab==='preview'?'text-blue-400 bg-gray-800':'text-gray-500'}`}>
                <Icons.Play size={18}/> <span className="text-[10px]">プレビュー</span>
              </button>
            </div>

            {/* サイドバー (プロジェクト管理) */}
            {sidebarOpen && (
                <div className="fixed inset-0 z-50 flex">
                    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm" onClick={()=>setSidebarOpen(false)} />
                    <div className="relative w-80 max-w-[85%] bg-gray-900 border-r border-gray-700 flex flex-col h-full shadow-2xl animate-in slide-in-from-left duration-200">
                        <div className="p-4 border-b border-gray-800 flex justify-between items-center">
                            <span className="text-white font-bold flex gap-2 items-center"><Icons.Folder size={20} className="text-blue-500"/> プロジェクト</span>
                            <button onClick={()=>setSidebarOpen(false)}><Icons.X size={20} className="text-gray-400"/></button>
                        </div>
                        {/* 保存ボタンなど */}
                        <div className="p-4 space-y-3 border-b border-gray-800">
                             <button onClick={()=>{
                                 const name = prompt('プロジェクト名を入力:');
                                 if(name) setProjects(prev => [{id:generateId(), name, files:[...files], createdAt:Date.now()}, ...prev]);
                             }} className="w-full bg-blue-600 text-white py-2 rounded text-sm font-bold hover:bg-blue-500">現在の状態を保存</button>
                             <button onClick={()=>setFiles(INITIAL_FILES)} className="w-full border border-gray-600 text-gray-300 py-2 rounded text-sm hover:bg-gray-800">初期化</button>
                        </div>
                        {/* リスト */}
                        <div className="flex-1 overflow-y-auto p-2 space-y-2">
                            {projects.map(p => (
                                <div key={p.id} className="bg-gray-800 p-3 rounded flex justify-between items-center group">
                                    <div onClick={()=>{if(confirm('読み込みますか？')) {setFiles(p.files); setSidebarOpen(false);}}} className="flex-1 cursor-pointer">
                                        <div className="text-sm font-bold text-gray-200">{p.name}</div>
                                        <div className="text-xs text-gray-500">{new Date(p.createdAt).toLocaleDateString()}</div>
                                    </div>
                                    <button onClick={()=>setProjects(prev=>prev.filter(x=>x.id!==p.id))} className="text-gray-500 hover:text-red-400 p-2"><Icons.Trash2 size={16}/></button>
                                </div>
                            ))}
                        </div>
                        <div className="p-4 border-t border-gray-800">
                            <button onClick={()=>{if(confirm('全削除しますか？')) setProjects([])}} className="w-full text-red-500 text-xs py-2 border border-red-900/30 rounded">履歴を全消去</button>
                        </div>
                    </div>
                </div>
            )}
          </div>
        );
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
